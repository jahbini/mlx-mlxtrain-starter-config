# Pipeline Integration Requirements for New Scripts

This document defines the rules and requirements for integrating new scripts into the build pipeline.
Scripts must adhere to these constraints to ensure reproducibility, consistency, and configurability.

1. Configuration-Driven Execution
- No hardcoded parameters.
- All filenames, directories, and options must come from default.config or a local override file.
- No command-line parameters are allowed. Scripts must only read config and environment variables.
- EXEC (script repo path) and PWD (run working directory) are always available as environment variables.

2. File Path Resolution
- All paths must resolve relative to either EXEC or PWD.
- Inputs/outputs must be explicitly listed in config.
- Temporary or scratch files must be created under PWD, never /tmp or home directories.

3. I/O Consistency
- Inputs: Defined in config (e.g., data_contract.json, train_ready.jsonl).
- Outputs: Defined in config (e.g., artifacts.json, experiments.csv).
- Logs: Each script must write logs under PWD/logs/, recording start/end time and execution parameters.

4. Execution Rules
- Scripts must be self-contained, non-interactive, and deterministic (same input/config → same output).
- Scripts must detect if another run is active (PID/lockfile in PWD) and exit cleanly if so.

5. Integration with the Pipeline
- Scripts must define a clear entry point (main function) with no side effects on import.
- All required upstream files must be validated before execution; missing files must cause exit with error.
- Outputs must be declared and traceable in config, not inferred by scanning directories.

6. Error Handling
- Scripts must fail fast: missing/invalid inputs must log an error and exit with non-zero code.
- Scripts must validate required config keys before execution.

7. Reproducibility & Portability
- Scripts must record git commit hash (if available) and timestamp in logs.
- No assumptions about user environment, shell, or Python path—everything comes from EXEC/PWD and config.
- No hidden defaults: every behavior must be traceable to config or explicit script logic.

8. Checklist for New Scripts
- Define inputs/outputs in config.
- Use only EXEC and PWD for path resolution.
- Accept no CLI params.
- Write logs to PWD/logs/.
- Validate config keys at startup.
- Exit cleanly on errors.
- Update pipeline runner to include script in correct order.
- Test with both default.config and override.yaml.

---
This spec ensures that all scripts are reproducible, config-driven, and portable within the pipeline system.
